services:
  - docker

branches:
  only:
    - master
    - module-9
    - module-10
    - module-11
    - module-12

script:
  - docker build --target test --tag my-test-image . 
  - docker run my-test-image tests
  - docker run --env SECRET_KEY --env MONGO_CLIENT my-test-image test_e2e
install:
  - wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
  - unzip terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo mv terraform /usr/local/bin/
  - rm terraform_"$TF_VERSION"_linux_amd64.zip
  - terraform init 
before_deploy:
  - docker login --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
  - docker build --target production --tag ${DOCKER_USERNAME}/my-image-prod:latest .
  - docker push ${DOCKER_USERNAME}/my-image-prod:latest
  - heroku container:login
deploy:
  provider: script
  script: curl -dH -X POST "$(terraform output -raw cd_webhook)"
  on:
    branch: module-12




env:
  global:
    - SECRET_KEY=secret-key
    - secure: "wV+sfKT3Nsz2ll3GKf8SDwrbwTHvgTbz/9OHcQalaxW6tOS2LdX1GcHifTlK1JgNnEcORkvjk9asjcw3B1H9NbSZdw0+8pQn5//she0bALHIYDCYcZuRHqwjHtw3Y41YBbFE/8God/e6U/IwYy5Hrlt/SZavCmK/aw8ivfwehiZAe8oPhDq6KnJSErMgmdd2gS+xvClQuhK0p4isRel9XXIuARm1m8viAZtixQdbWH8lZ2pNEzQNdsLmJJ2WazjqkYz34g/sXYJcs8GIk5PlPj3HUWtRbX3DuikzmQdReuxkD7Q/3ONymNDb9xXd7jZGgCeMVGHd+A7Tu8B7eT9Vi7sUm9egs3NPTDD0tFoiKC8DR++WKMxuE8VaEMOnI/CfZaxOnqJOshCViCtOhxV6Il2KGtNjqjOZuf1IlUynD3yvI7V0trzyxwy728H8lCVSIfv7+dZ2Z5k3GX258ny6C00iD3zrqJ/OTv4AYPK3YEiyW/nRFhuDzrPI5JozQM8ibcvCrbYGf7qi6UWZxZ5X2BT1+KIk2ZVRUnSYJRbLeIsmy2MT2wiAcdx4itlrPwWmJiBRN4U8nhqjz/AUsWe+0cHzR1CAfsyjMeQOIEm70HAsU/dFaazHHCgaGFGy/2LyjH/de4SxjSvnF10cvH/7baOMD9aRSY4YeMIs3yNVLdE="
    - secure: "cJH8SmtvOLrVREmrpk7GLNHqlnBHFqdy1siyRYBa9aDMngRND8zakHiE6ybDUVdLehHlafPBo3QtkRddqj+Pyg4ldrc47g0x5riz/nd5WZ3wqpSdtUZdNOJdqNZVYevS8jmKQ0LuOPPC6Jy/PzwpNSqnP5ZJs5tucEyId2KaaqvX1hKKdo10Adr1nzXUhyPkvc57Uls+mHUMq0v5z24FAshXQlow2F+R7FgqFF4BMOMZFE3hCAOJpRCvPr7/VWs28bc6mEmFt+l333cipuH0wTFtZSsR0Ujk+71ksLID7e4YgHtq4xXS4yO+niorLgDvKhFvp5yNvUmYfN3kXD8tfQNGtLivDnqyJp6mI79+EQMS7yqHlTqRFYBqmhlATw1FIfdMi1Tsrv/XtRgXjKkLfjIqmk6Byjqv7hgqL+cirrdSpDwrTuMTRnZTqWBBoPFwaIbAc3q4YtoG4+sg5/sHQS04xHSAT3Jit1H6tqUBE3k/mPir08bJpVOzBvsvtXyGtr8ItxK2WenuTNjtjr+On/Y+FG7ljTYjQCU5ltyBER5A8tlryJfDDSu5DOGv2mNZf/8idPi6ZXQqZ/KeQyO3QXDkJyxEeJsH5rODNuqgSjDrPs3mqQpsden4JsxMf9OcWnzpOggJk28QIpTD2dsAma9WutviHBrbJZLUONlVZek="
    - TRELLO_TODOID=5fb51cfd98afad055cb08c82
    - TRELLO_DONEID=5fb51cfd98afad055cb08c84
    - TRELLO_BOARDID=5fb51cfd98afad055cb08c81
    - DOCKER_USERNAME=aj1993
    - secure: "sxh1iNdEEbyhmdPc265HjyNk+ZCffW5zIp3mBxaGEz2Ttwt7gbVKEC5A0DujBeh/dmUahOM1vsP1XPLu3IkTymB1a7EF+7mhyDQbfcunqcxaehYJFgOgK8NHf1SrgGGhlwd7JEk69XuTG9CZfmxqUC2eA+Ztinu9NcUt437THKZ9njX8Kq/1aMi7/5gqttiXZmzKlGzoBLitzUUr9H8AT95p3e82GldI3pVJjCvwLBN+r22zznIQ5z/o32kn9qts6uy+0EX8BUP0evW1px8VkKEAAYxV3/frzwJieJ3a1PF7a7KzG1397GYw60/V3HIdJ1XqiTBbxfFETY4TyC1PBVOQ6241m6Ueac69RrF4lCjECFUjnrDVdN1TWrD9yZrXl/MJAEKA0Gp6kFrhUJHwt2SKeiN6WgAkdFPQJvvVerZhPgy0jt4wUN9WKhM8fX1V+d7C+L7uTWibLRPxTMHFSiDFljyipd6D1Q5+RHode93ZfwplrdCKARjNLz8Lx0fnBHp3FpFESgEPKlkdocrnCF05AxcdypxJydqtzj5O+uZTw5IGiNtr/w6Ew47dHsD1mpyubfSpZNdkWtQdUxO75rgHiQwk6WwKcA8dpAlkOpk5De4HwxT6If4T9nhfJJnz2I3yy67MiKFrgG8DSDxbGV92ydkIOvP2N8EiODYBFVs="
    
    - secure: "KABbZQuKJc/6mE/WMafMW2YXo2A6UPCgTiZZorTmiWRs/jfT/fSUeBuqnJ6WLpHPg0uGODXBr+nHuoZIA1iUWuMaJ49CA5ZRSedeCm9uePWvIjPJY0hLwbyOHaBJ7+nEk/UXWCaYPtTWkC8OFavbMpWF4CeEBvaQEnOy2CrLTtcwG1L6Sm6vbM2zn87vEwJeYeByhcQDq42DD+cbLiQwGukSA3Tb0wYMmys5/UQk/VbxZ29TaSPDW+y7mRpDU0H8BfixsGL1jybEZSsW3dbA4nXoaXsLhvxJ2bpwHNnSAu0nZ4gH6lC5Ib/44zGc9xlVpCFnB7V/sj4ni/nu0PFKJo6Nk4nfhyyXseSUDMX93XQz76GT1oZUOY/hT1xHfwyrcyYmCRMa2pxgEqIjyTDGwmCuz8PkZw4gG+5Q3zoV9iuNZI/AV5ZKjm4yzpZNRjG3WaSgvDOBXrik84oPsmseiXw85bYWOy7+hMUk5zpH1vhqZIpnKsXtZOz0D0L3O6wk8VpEaJEaQkKuLpEPtmfrZbUk9kIxV66dEbNKH9EcLtn2BVfsz4iANn7+enkovXqVfLS2H56FXq1bwwODtYyiDkjIs93urWwFFkJaLribD9+2VjdFf3beCeaMH0WV+jGZT47lRc1S1BEhnI7zeE3A0Pjx9GeLppl9KdnxdMFKjkI="
    - secure: "tj7VA87VHKVhsP9XYzYjQ54z9V+9Q8yqHo5unqwuazwRPoqGCtnEuaQv4XGFoYiVJoFujmGzsdNwtU0TnyT07G9z9zMQoT7KksH9Y+qjsBZm6TrpD8r1rgLv72jzIqciiBZy9rXneVT85hG0uXoIpZ/uhW60ACA/3Xr1GjXW4Z6j3NWKfIkj57PfmYmD+AMFtHz9T3+k/gEXKHw5L41I1OYK54fj1269UoL2JkdfJiGPJ9KbytNrHBWhIv3oUIspbyKWrJTOtH1AfYRryJHSsESF4m2/g0Ylm18YOu66cGkJbO8S+KKSCs9SqhnqWhSCo7O3A+j3FV8eZ8KGJipK0hatY7gsyoO0v1AYVRs6bcipXo1p5NE5JCQLgePgDosVT5uZ0+JivqPZ04OiLbX/qmZSOcADbJA5lqfHk2IIcMeaK5Sxz3Dixy7JKQ+NncoD9brH7lESPnU1HkjTqW+Y4UbwVABQ2Sg/rkQKDkDLjTx5ZF/DLYmf5juzi/8T5KXoF6pw5b7Hto8k/3CACuXGJ9UEap9Y+yGNMcwShrA42Es+mMkgLjrG6QIrLRdlNDwkjCdPZGhro447XeLlTB8sW/f21vXYHZ1GhYDZOjNenFs8SIFOSsdOTB+xTgpcww2IJkGfg3SqiKHik7hL8/FUDjBUP+8TGnd0N1jEz3KkVZc="

    - secure: "iFZSRORUbxziA5R1E3KMLGKp1/WwhnyzISS/C641N2wa8YyYQzWJHlzqb8R/Jv2rPrZxZ9XRAuLQqvwC2zDIeUQ2fiGisPe7567O9cTv13vwYsMU99btBNa3rsdmQDL2DeHeWVSpZmN3TNburg5dNL7s8no46V6BPV5dshZMAnCil2kjvbn1ZaJqEa5zxKW8lUpwPjso+sKSjT6O/n1pvcz4UvD5VeMeN1w+G8e7DbECNvhxpsVV6jrgSKA1taqHYCJ8UcebImY04AbsLOAKJv+ErjoXt0ad8K0HZb85mt2y+OkiwPYdA/AS1cbmWLXjsNyDmG2CYWU6tC+zugWmnmi+98Hk50Ip7FPM1LvCZr1+YkfOqrNheDfeRYPDS8ZhfEFsTnYC8/gCR49QZaeIs3vkmEpjikvIMgSvYkcU+uyLqUObv3943NHmniCcODOTGJHPc4eBfd3rf1FeEHOyA3MMC5CmUW952VqPCLN39FE8HoR0uLixJmTjjoHorzk6213FE7i4l4PjmIChfjYB5KuwPeHd3LPxwKm/ad/OsN7L6ajvSY/rg5+egi3LtRstwZHFey7mOwZvNPEQUmy/y3UEGLw+rH5BFjCjl0T532wWfdLZ3v3UITBmedrpNdr3YS2T1OJ98Rk7ogfHbSzLhIEDvvUtN7TY0SySTah0tMA="

    - secure: "Tuuq3aHWY3w6MD9jGfWpFTq2hnuch+UpOiDUbJWJOGgC/oYZWlEvk/hD9BTia5kti8B0KsAcpLSr3OEk5hAYqAaNgWSo1GdWG1WFcxVJDHHwD0igRGkHLVJ0tCcgM21aSUBjjXzMpZaNKCuugcXta/W1QDZzQLq2cT8a27VMzl0TUT7bswm93fg7WqHz7IQjiTt1c1iBNh4fHql1CMwrPtuLJCK+YRQ00vdGcL1JrfW0xCaMDiAjfq071mbCYyiDoOQhqsxHWiEUuwlYnHbMtjlgWdpuQ9FV/VX/z/xbfdl65mN0xglwnq7hw46e6s5DknpKGFJGhoPSasdMAU3aNMhtmzYdUCkrONjjPeVXN7Lqh6CuNW9nyjK/4Rja5UdbuICfgUaarJJkcEpYsUbv7KO4z0w11ARU7/MCOHBxJOoYm0/AqXU2QKKMh+Aj+yOK0XgETTDp9UkzoW0BA9K/M1iOP2O6e+zLyW+Tnmd/dUCFUTCwOm5ru1OUB5voV1lQhAe0E9hewGM/73Dg1g6I1lgYl7VxOA5/LCHZXfZmhmEmsv0sQoF0NWdsHckxe2ctwseYHA4ye8SJO1oPQMeWbIMVzae55+D799soLhecpIad1EGfgsgMN9+E4yGEfN8T7jj0pK1scnznXvtCma0tQf2sVYAfSM4zLhi8pzpCjbM="

    - secure: "nshN5LVhAF6nJ0tvWXb919cGScRRJY2MFJGzF/CY3isNWCzDORMWu5EasINiOvLH+byo0srZt20EcxUg9aWGs8hWBbTcDQw65YxB78HWBZOnnXeuzqVZrRfkbA/CiR5FuIPwp2VPXp67ss2yDhFvMNpiBsNYiJ6VL97K667yZTrqQoP/MzOvcRvVdssN128HN9885wlYIach7YqyY8j3t91QhbSFwWX4Pi7IOR1C6MyAbyHBLXhjlBI508FzY/l/SVQfOHE3uci2TtmdEghC1LcqsvsPhXiyHzyWEi7mxrtGwVqiQTHkxOL3ptH26RgBHvPYQCL4kDhlLS3zrmmDZBIZ5T9Fie1Ld+N4Vs+C/aMgpY2mGBgOurJIjHLRshePa9KGOQ6Y9TpgiWpTHVs3WNb7HGCOejOAaWltHuqxnu4DEZEtMpvpbpcbI8AszZ1Tsu0JAfRnahOkfDWTJcZ3vjKgUADUJfAqTI8DVINUC7pMsHjpopiJmKi9Zx+xDbYYB+UGbJUMg0N+dx+Eyty108diejgauX+KnhtGfrF5MlhfzV5aPALk5UswaaVopfTsx37MDpMiosHKKrOLHWF/A9p1p2b0nBaCo8bu/rULCGAfPjI3L/41lv5M0bPP++1QTYxN5S5ZmUJGtM4MKIKkxQhGN2giP5T7UfVeCN+UYsE="
    - secure: "OGeKC+VqlofxcCEY+CbAcrayo20hAIgDmUbYds0MEyylyvmnRmPjNvCeqSi6MIkNT87MkqfVWX5UKKUQyovTdPyNL2jvo+nx92I83RnzCb2REElmzPcp+iGCoTgQJt5pdrErCkfPbKO2QEZTE6kMD6qUJw7zJAQ97GulwK13gxLqxfAMKhP1ufKJUtCQGsrwr9m3GrXGMMkgnDSoJuIa53zi1RLTGdo925u7gJfoeSZbBsLdpg2x6Dpyffh8CjQwrKdmr1Yz1RL36CajC3mn8d4/Io55lf1yBh51wSkvtnYPRHaMrvLmSsN6Gn46+xjoahlhE8Nac8Hm6OVb+tmdZiCfxENmw+Mp6+C/19xN3IGKWfOGDhP+pn6dzLZ6DXTXZA8MPEd59yS2HKzmdOCfRzytb860qBhZMsFeepnLsx+a8lj2THnwJ/nzTgTaRiCxJKvilh2sX9fw+KAL+bFtz0aoqd1YeMXBlOn9E3ijMF/EEIcH4v8n7SIu4vjjLWqoyZ/uTmvSZr6hQLKvhqZuhrphqRMRCMMGKDjp4e6KbKJJS12P6SiQ2/aBti/wJS4rPH7XdxsmFvzQuceCuMUXHfxhnqMvo9AeAspwjcI/XpfNridD1Wu4NzGNRP7RTWCUknwrRhBPEu5bPIUQTislFJflPAqND46uQqFEeE7trP4="
    - secure: "kw27xBGfpa8/W8dCA4ywjlcpU0pujXNCKvtN/h5nSFbxvDCh6yKc0X8YF7Q8HQzkIkVEIySogP5Vxb6Yh8+DBx0ovv0SW2gUG/b/NSO63oJ2GT0xiEXkx1lBV/GmFHo4KR9vBwlDMnmL4+NRZvbJT8dmoM08bCSlQRf4zcuJc1z2qnvsNmDpuBIie+DndaWoP86/8ktl5iq/Nz3jgDkvo9onnXHmWHdPaSQ1s9JOKAGhSpoR1hgHxJleNmha5pmLzfH2BjYgehIIdL9pwvlt9lPZHq86bu8CayyxslwD8OlUsF0trp4gFBUeHZchIepYDX8oCzlbn79O8dRuSILQWoEEGU45NzMM5mF/9khImLdewq7TqQuRnh+86Y5CZf5jejAfxOO7pO29wPDmS84s1MahWH3tN36ytTAVVTvYM2CJ2vk6gbEZAAOc9EngbfZR1N5eHXG4xLGrUfGIXBmhDS1TWEJAm9ZNqmfs7ITALauMM/ay26Jb5kqPmmBgvPivijpn338VwSFDozxpFgdoiZMb0OpCQfmSVfj+7p13+LIMcJqtw16EWYn8bRS8ScMmDZ9NBdUDi3RGczihIfDItjhRRq0FUsrn+Uj9wNffpbPnGzNVbcP1sJCXK9tHonepMn817ON1myGm0o9CY65i5QLcGmbnyKJ3QdamDV1npN4="
    - secure: "RacM8PagHtHPAdx9twbzcd7J8MKfQ2tlV5I8VK1IPJ9wameuycj6k4MpCUjdGEOfNbTTU2XV3/fWE//3htRqLWcstWDGExAm013M33vpKDoPtag9e3x1xVwgpmjge4v9z9+LkJG+xh4GfUkB0XM2oPrw6SjQNCjfeN7Mx1lfaphtCRbuuj8FmrXP8nvxaTov7qAX63QY0Rv0wOptlCaK1iQRpHrDMWktSHd/5r181FAE8ydZGX+yKipznQk3nAA/q34cUsvPI2l3kvuCIlpv7HL7PYAe29dXSFnSx3q2w69jHlUN3Y/kPmvXml28R6/Sj0d5RRIjyGsSkf8bTbItc5MT+jHLcXZpoEVKJoA10OBywhmrJKoFQ+4Uiy42pNwIddqKsjYyYIoloHHgJF4OcdkFUGtbQsUpcSQOS3U5qaKALg7+GwvYon1iFclOvGVa1DvlYiY1+QdDLFFtCKmdXoor1EaiejuofoUX1ddqgAqejGe822sdHELQ+it2R63g3gIZItaJWSWeDI4dW9N0hmSAxlHCt23Q5mXllNcakUIAcr/9e5eBVroHLoCw9JQaXI29/c3wFtXwTaMXHKV+lzVXDvLGe1JTY5IisaKjk105dbpbbHff8Y4s628eDklzszgE0uh9FZ4D34WQJ5Ibcmay+83rasIPnjIrOu1HS00="

    - TF_VERSION=0.14.7