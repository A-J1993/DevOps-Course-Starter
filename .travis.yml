services:
  - docker

branches:
  only:
    - master
    - module-9
    - module-10
    - module-11
    - module-12
    - module-13

script:
  - docker build --target test --tag my-test-image . 
  - docker run my-test-image tests
  - docker run --env SECRET_KEY --env MONGO_CLIENT my-test-image test_e2e
install:
  - wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
  - unzip terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo mv terraform /usr/local/bin/
  - rm terraform_"$TF_VERSION"_linux_amd64.zip
  - terraform init 
before_deploy:
  - docker login --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
  - docker build --target production --tag ${DOCKER_USERNAME}/my-image-prod:latest .
  - docker push ${DOCKER_USERNAME}/my-image-prod:latest
deploy:
  provider: script
  script: bash webhook.sh
  on:
    branch: module-13




env:
  global:
    - SECRET_KEY=secret-key
    - secure: "wV+sfKT3Nsz2ll3GKf8SDwrbwTHvgTbz/9OHcQalaxW6tOS2LdX1GcHifTlK1JgNnEcORkvjk9asjcw3B1H9NbSZdw0+8pQn5//she0bALHIYDCYcZuRHqwjHtw3Y41YBbFE/8God/e6U/IwYy5Hrlt/SZavCmK/aw8ivfwehiZAe8oPhDq6KnJSErMgmdd2gS+xvClQuhK0p4isRel9XXIuARm1m8viAZtixQdbWH8lZ2pNEzQNdsLmJJ2WazjqkYz34g/sXYJcs8GIk5PlPj3HUWtRbX3DuikzmQdReuxkD7Q/3ONymNDb9xXd7jZGgCeMVGHd+A7Tu8B7eT9Vi7sUm9egs3NPTDD0tFoiKC8DR++WKMxuE8VaEMOnI/CfZaxOnqJOshCViCtOhxV6Il2KGtNjqjOZuf1IlUynD3yvI7V0trzyxwy728H8lCVSIfv7+dZ2Z5k3GX258ny6C00iD3zrqJ/OTv4AYPK3YEiyW/nRFhuDzrPI5JozQM8ibcvCrbYGf7qi6UWZxZ5X2BT1+KIk2ZVRUnSYJRbLeIsmy2MT2wiAcdx4itlrPwWmJiBRN4U8nhqjz/AUsWe+0cHzR1CAfsyjMeQOIEm70HAsU/dFaazHHCgaGFGy/2LyjH/de4SxjSvnF10cvH/7baOMD9aRSY4YeMIs3yNVLdE="
    - secure: "cJH8SmtvOLrVREmrpk7GLNHqlnBHFqdy1siyRYBa9aDMngRND8zakHiE6ybDUVdLehHlafPBo3QtkRddqj+Pyg4ldrc47g0x5riz/nd5WZ3wqpSdtUZdNOJdqNZVYevS8jmKQ0LuOPPC6Jy/PzwpNSqnP5ZJs5tucEyId2KaaqvX1hKKdo10Adr1nzXUhyPkvc57Uls+mHUMq0v5z24FAshXQlow2F+R7FgqFF4BMOMZFE3hCAOJpRCvPr7/VWs28bc6mEmFt+l333cipuH0wTFtZSsR0Ujk+71ksLID7e4YgHtq4xXS4yO+niorLgDvKhFvp5yNvUmYfN3kXD8tfQNGtLivDnqyJp6mI79+EQMS7yqHlTqRFYBqmhlATw1FIfdMi1Tsrv/XtRgXjKkLfjIqmk6Byjqv7hgqL+cirrdSpDwrTuMTRnZTqWBBoPFwaIbAc3q4YtoG4+sg5/sHQS04xHSAT3Jit1H6tqUBE3k/mPir08bJpVOzBvsvtXyGtr8ItxK2WenuTNjtjr+On/Y+FG7ljTYjQCU5ltyBER5A8tlryJfDDSu5DOGv2mNZf/8idPi6ZXQqZ/KeQyO3QXDkJyxEeJsH5rODNuqgSjDrPs3mqQpsden4JsxMf9OcWnzpOggJk28QIpTD2dsAma9WutviHBrbJZLUONlVZek="
    - TRELLO_TODOID=5fb51cfd98afad055cb08c82
    - TRELLO_DONEID=5fb51cfd98afad055cb08c84
    - TRELLO_BOARDID=5fb51cfd98afad055cb08c81
    - DOCKER_USERNAME=aj1993
    - secure: "sxh1iNdEEbyhmdPc265HjyNk+ZCffW5zIp3mBxaGEz2Ttwt7gbVKEC5A0DujBeh/dmUahOM1vsP1XPLu3IkTymB1a7EF+7mhyDQbfcunqcxaehYJFgOgK8NHf1SrgGGhlwd7JEk69XuTG9CZfmxqUC2eA+Ztinu9NcUt437THKZ9njX8Kq/1aMi7/5gqttiXZmzKlGzoBLitzUUr9H8AT95p3e82GldI3pVJjCvwLBN+r22zznIQ5z/o32kn9qts6uy+0EX8BUP0evW1px8VkKEAAYxV3/frzwJieJ3a1PF7a7KzG1397GYw60/V3HIdJ1XqiTBbxfFETY4TyC1PBVOQ6241m6Ueac69RrF4lCjECFUjnrDVdN1TWrD9yZrXl/MJAEKA0Gp6kFrhUJHwt2SKeiN6WgAkdFPQJvvVerZhPgy0jt4wUN9WKhM8fX1V+d7C+L7uTWibLRPxTMHFSiDFljyipd6D1Q5+RHode93ZfwplrdCKARjNLz8Lx0fnBHp3FpFESgEPKlkdocrnCF05AxcdypxJydqtzj5O+uZTw5IGiNtr/w6Ew47dHsD1mpyubfSpZNdkWtQdUxO75rgHiQwk6WwKcA8dpAlkOpk5De4HwxT6If4T9nhfJJnz2I3yy67MiKFrgG8DSDxbGV92ydkIOvP2N8EiODYBFVs="
    
    - secure: "iFZSRORUbxziA5R1E3KMLGKp1/WwhnyzISS/C641N2wa8YyYQzWJHlzqb8R/Jv2rPrZxZ9XRAuLQqvwC2zDIeUQ2fiGisPe7567O9cTv13vwYsMU99btBNa3rsdmQDL2DeHeWVSpZmN3TNburg5dNL7s8no46V6BPV5dshZMAnCil2kjvbn1ZaJqEa5zxKW8lUpwPjso+sKSjT6O/n1pvcz4UvD5VeMeN1w+G8e7DbECNvhxpsVV6jrgSKA1taqHYCJ8UcebImY04AbsLOAKJv+ErjoXt0ad8K0HZb85mt2y+OkiwPYdA/AS1cbmWLXjsNyDmG2CYWU6tC+zugWmnmi+98Hk50Ip7FPM1LvCZr1+YkfOqrNheDfeRYPDS8ZhfEFsTnYC8/gCR49QZaeIs3vkmEpjikvIMgSvYkcU+uyLqUObv3943NHmniCcODOTGJHPc4eBfd3rf1FeEHOyA3MMC5CmUW952VqPCLN39FE8HoR0uLixJmTjjoHorzk6213FE7i4l4PjmIChfjYB5KuwPeHd3LPxwKm/ad/OsN7L6ajvSY/rg5+egi3LtRstwZHFey7mOwZvNPEQUmy/y3UEGLw+rH5BFjCjl0T532wWfdLZ3v3UITBmedrpNdr3YS2T1OJ98Rk7ogfHbSzLhIEDvvUtN7TY0SySTah0tMA="

    - secure: "Tuuq3aHWY3w6MD9jGfWpFTq2hnuch+UpOiDUbJWJOGgC/oYZWlEvk/hD9BTia5kti8B0KsAcpLSr3OEk5hAYqAaNgWSo1GdWG1WFcxVJDHHwD0igRGkHLVJ0tCcgM21aSUBjjXzMpZaNKCuugcXta/W1QDZzQLq2cT8a27VMzl0TUT7bswm93fg7WqHz7IQjiTt1c1iBNh4fHql1CMwrPtuLJCK+YRQ00vdGcL1JrfW0xCaMDiAjfq071mbCYyiDoOQhqsxHWiEUuwlYnHbMtjlgWdpuQ9FV/VX/z/xbfdl65mN0xglwnq7hw46e6s5DknpKGFJGhoPSasdMAU3aNMhtmzYdUCkrONjjPeVXN7Lqh6CuNW9nyjK/4Rja5UdbuICfgUaarJJkcEpYsUbv7KO4z0w11ARU7/MCOHBxJOoYm0/AqXU2QKKMh+Aj+yOK0XgETTDp9UkzoW0BA9K/M1iOP2O6e+zLyW+Tnmd/dUCFUTCwOm5ru1OUB5voV1lQhAe0E9hewGM/73Dg1g6I1lgYl7VxOA5/LCHZXfZmhmEmsv0sQoF0NWdsHckxe2ctwseYHA4ye8SJO1oPQMeWbIMVzae55+D799soLhecpIad1EGfgsgMN9+E4yGEfN8T7jj0pK1scnznXvtCma0tQf2sVYAfSM4zLhi8pzpCjbM="

    - ARM_CLIENT_ID=7ec67553-f594-41be-a99c-58925d3e40fa
    - ARM_TENANT_ID=7d6f97d6-d755-4c10-b763-409cc4b6638f
    - ARM_SUBSCRIPTION_ID=d33b95c7-af3c-4247-9661-aa96d47fccc0
    - secure: "RacM8PagHtHPAdx9twbzcd7J8MKfQ2tlV5I8VK1IPJ9wameuycj6k4MpCUjdGEOfNbTTU2XV3/fWE//3htRqLWcstWDGExAm013M33vpKDoPtag9e3x1xVwgpmjge4v9z9+LkJG+xh4GfUkB0XM2oPrw6SjQNCjfeN7Mx1lfaphtCRbuuj8FmrXP8nvxaTov7qAX63QY0Rv0wOptlCaK1iQRpHrDMWktSHd/5r181FAE8ydZGX+yKipznQk3nAA/q34cUsvPI2l3kvuCIlpv7HL7PYAe29dXSFnSx3q2w69jHlUN3Y/kPmvXml28R6/Sj0d5RRIjyGsSkf8bTbItc5MT+jHLcXZpoEVKJoA10OBywhmrJKoFQ+4Uiy42pNwIddqKsjYyYIoloHHgJF4OcdkFUGtbQsUpcSQOS3U5qaKALg7+GwvYon1iFclOvGVa1DvlYiY1+QdDLFFtCKmdXoor1EaiejuofoUX1ddqgAqejGe822sdHELQ+it2R63g3gIZItaJWSWeDI4dW9N0hmSAxlHCt23Q5mXllNcakUIAcr/9e5eBVroHLoCw9JQaXI29/c3wFtXwTaMXHKV+lzVXDvLGe1JTY5IisaKjk105dbpbbHff8Y4s628eDklzszgE0uh9FZ4D34WQJ5Ibcmay+83rasIPnjIrOu1HS00="

    - TF_VERSION=0.14.7
    - secure: "PeNAAep7Wgl5OVpBo1Ny2rVlKnqIkEvIcL1PrV6kmqHmOQbR++s54xdgLa18uPxfka1z0s4yBSSKuT0XPIS4QU9KeQeHGQtBjJ8SDe/iA47gPD7GBn5Hz1+vAUsjfmMKTvI7qPoXBiF4Ky9SmzBse0D62dwq3DZc9rAywT6nkuUwLBDtccjqDyzaiiXCAaMJNrMTZNZBYlnP3JvPlhJ0anw0/UpJsdLobIPPCDeU8ZUUx3cGFBEfJvMYVro0FBgS1vBSfiyjvgW9emij7CfNUFv/zMaPtfQ73vium0a9PJ8TjLIyow1siZ0drPtz8RZLm2iDsxvi9n2Dg/xPKEsDMPrsXykF+7YSTDfKVWlIBpsSinicRlSJEpI/stTCquyQPwfJD+TGBV9umFlhyCMRZfyywNiIkaTJF5saQG/CumN0bCxdqVLqp4eqTwRm7jJt+Lh12AL932kZliPbj1MebIHn9dGHtUYa5JRnuplcFjwjsyeWfS5nu/Zq213U0h3aV0b356H96omHn37Uma1LDKSo/yNTFdhXm1a3zkeqbLoJXv4NgJpX8YIEtc8PSFsSDvIORQ+jKOXVTVhSVPbSuyrKm233C2iDmeLTE77gbTyoTethfMX72WEC4tLT6YNW8QT5LkWCPo3sySNWTIUjKLFM8XboRI0OIR5vyhEUyEY="