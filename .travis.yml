services:
  - docker

branches:
  only:
    - master
    - module-9
    - module-10
    - module-11

script:
  - docker build --target test --tag my-test-image . 
  - docker run my-test-image tests
  - docker run --env SECRET_KEY --env MONGO_CLIENT my-test-image test_e2e
before_deploy:
  - docker login --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
  - docker build --target production --tag ${DOCKER_USERNAME}/my-image-prod:latest .
  - docker push ${DOCKER_USERNAME}/my-image-prod:latest
  - heroku container:login
deploy:
  provider: script
  script: bash webhook.sh 
  on:
    branch: module-11




env:
  global:
    - SECRET_KEY=secret-key
    - secure: "wV+sfKT3Nsz2ll3GKf8SDwrbwTHvgTbz/9OHcQalaxW6tOS2LdX1GcHifTlK1JgNnEcORkvjk9asjcw3B1H9NbSZdw0+8pQn5//she0bALHIYDCYcZuRHqwjHtw3Y41YBbFE/8God/e6U/IwYy5Hrlt/SZavCmK/aw8ivfwehiZAe8oPhDq6KnJSErMgmdd2gS+xvClQuhK0p4isRel9XXIuARm1m8viAZtixQdbWH8lZ2pNEzQNdsLmJJ2WazjqkYz34g/sXYJcs8GIk5PlPj3HUWtRbX3DuikzmQdReuxkD7Q/3ONymNDb9xXd7jZGgCeMVGHd+A7Tu8B7eT9Vi7sUm9egs3NPTDD0tFoiKC8DR++WKMxuE8VaEMOnI/CfZaxOnqJOshCViCtOhxV6Il2KGtNjqjOZuf1IlUynD3yvI7V0trzyxwy728H8lCVSIfv7+dZ2Z5k3GX258ny6C00iD3zrqJ/OTv4AYPK3YEiyW/nRFhuDzrPI5JozQM8ibcvCrbYGf7qi6UWZxZ5X2BT1+KIk2ZVRUnSYJRbLeIsmy2MT2wiAcdx4itlrPwWmJiBRN4U8nhqjz/AUsWe+0cHzR1CAfsyjMeQOIEm70HAsU/dFaazHHCgaGFGy/2LyjH/de4SxjSvnF10cvH/7baOMD9aRSY4YeMIs3yNVLdE="
    - secure: "cJH8SmtvOLrVREmrpk7GLNHqlnBHFqdy1siyRYBa9aDMngRND8zakHiE6ybDUVdLehHlafPBo3QtkRddqj+Pyg4ldrc47g0x5riz/nd5WZ3wqpSdtUZdNOJdqNZVYevS8jmKQ0LuOPPC6Jy/PzwpNSqnP5ZJs5tucEyId2KaaqvX1hKKdo10Adr1nzXUhyPkvc57Uls+mHUMq0v5z24FAshXQlow2F+R7FgqFF4BMOMZFE3hCAOJpRCvPr7/VWs28bc6mEmFt+l333cipuH0wTFtZSsR0Ujk+71ksLID7e4YgHtq4xXS4yO+niorLgDvKhFvp5yNvUmYfN3kXD8tfQNGtLivDnqyJp6mI79+EQMS7yqHlTqRFYBqmhlATw1FIfdMi1Tsrv/XtRgXjKkLfjIqmk6Byjqv7hgqL+cirrdSpDwrTuMTRnZTqWBBoPFwaIbAc3q4YtoG4+sg5/sHQS04xHSAT3Jit1H6tqUBE3k/mPir08bJpVOzBvsvtXyGtr8ItxK2WenuTNjtjr+On/Y+FG7ljTYjQCU5ltyBER5A8tlryJfDDSu5DOGv2mNZf/8idPi6ZXQqZ/KeQyO3QXDkJyxEeJsH5rODNuqgSjDrPs3mqQpsden4JsxMf9OcWnzpOggJk28QIpTD2dsAma9WutviHBrbJZLUONlVZek="
    - TRELLO_TODOID=5fb51cfd98afad055cb08c82
    - TRELLO_DONEID=5fb51cfd98afad055cb08c84
    - TRELLO_BOARDID=5fb51cfd98afad055cb08c81
    - DOCKER_USERNAME=aj1993
    - secure: "sxh1iNdEEbyhmdPc265HjyNk+ZCffW5zIp3mBxaGEz2Ttwt7gbVKEC5A0DujBeh/dmUahOM1vsP1XPLu3IkTymB1a7EF+7mhyDQbfcunqcxaehYJFgOgK8NHf1SrgGGhlwd7JEk69XuTG9CZfmxqUC2eA+Ztinu9NcUt437THKZ9njX8Kq/1aMi7/5gqttiXZmzKlGzoBLitzUUr9H8AT95p3e82GldI3pVJjCvwLBN+r22zznIQ5z/o32kn9qts6uy+0EX8BUP0evW1px8VkKEAAYxV3/frzwJieJ3a1PF7a7KzG1397GYw60/V3HIdJ1XqiTBbxfFETY4TyC1PBVOQ6241m6Ueac69RrF4lCjECFUjnrDVdN1TWrD9yZrXl/MJAEKA0Gp6kFrhUJHwt2SKeiN6WgAkdFPQJvvVerZhPgy0jt4wUN9WKhM8fX1V+d7C+L7uTWibLRPxTMHFSiDFljyipd6D1Q5+RHode93ZfwplrdCKARjNLz8Lx0fnBHp3FpFESgEPKlkdocrnCF05AxcdypxJydqtzj5O+uZTw5IGiNtr/w6Ew47dHsD1mpyubfSpZNdkWtQdUxO75rgHiQwk6WwKcA8dpAlkOpk5De4HwxT6If4T9nhfJJnz2I3yy67MiKFrgG8DSDxbGV92ydkIOvP2N8EiODYBFVs="
    
    - secure: "KABbZQuKJc/6mE/WMafMW2YXo2A6UPCgTiZZorTmiWRs/jfT/fSUeBuqnJ6WLpHPg0uGODXBr+nHuoZIA1iUWuMaJ49CA5ZRSedeCm9uePWvIjPJY0hLwbyOHaBJ7+nEk/UXWCaYPtTWkC8OFavbMpWF4CeEBvaQEnOy2CrLTtcwG1L6Sm6vbM2zn87vEwJeYeByhcQDq42DD+cbLiQwGukSA3Tb0wYMmys5/UQk/VbxZ29TaSPDW+y7mRpDU0H8BfixsGL1jybEZSsW3dbA4nXoaXsLhvxJ2bpwHNnSAu0nZ4gH6lC5Ib/44zGc9xlVpCFnB7V/sj4ni/nu0PFKJo6Nk4nfhyyXseSUDMX93XQz76GT1oZUOY/hT1xHfwyrcyYmCRMa2pxgEqIjyTDGwmCuz8PkZw4gG+5Q3zoV9iuNZI/AV5ZKjm4yzpZNRjG3WaSgvDOBXrik84oPsmseiXw85bYWOy7+hMUk5zpH1vhqZIpnKsXtZOz0D0L3O6wk8VpEaJEaQkKuLpEPtmfrZbUk9kIxV66dEbNKH9EcLtn2BVfsz4iANn7+enkovXqVfLS2H56FXq1bwwODtYyiDkjIs93urWwFFkJaLribD9+2VjdFf3beCeaMH0WV+jGZT47lRc1S1BEhnI7zeE3A0Pjx9GeLppl9KdnxdMFKjkI="
    - secure: "tj7VA87VHKVhsP9XYzYjQ54z9V+9Q8yqHo5unqwuazwRPoqGCtnEuaQv4XGFoYiVJoFujmGzsdNwtU0TnyT07G9z9zMQoT7KksH9Y+qjsBZm6TrpD8r1rgLv72jzIqciiBZy9rXneVT85hG0uXoIpZ/uhW60ACA/3Xr1GjXW4Z6j3NWKfIkj57PfmYmD+AMFtHz9T3+k/gEXKHw5L41I1OYK54fj1269UoL2JkdfJiGPJ9KbytNrHBWhIv3oUIspbyKWrJTOtH1AfYRryJHSsESF4m2/g0Ylm18YOu66cGkJbO8S+KKSCs9SqhnqWhSCo7O3A+j3FV8eZ8KGJipK0hatY7gsyoO0v1AYVRs6bcipXo1p5NE5JCQLgePgDosVT5uZ0+JivqPZ04OiLbX/qmZSOcADbJA5lqfHk2IIcMeaK5Sxz3Dixy7JKQ+NncoD9brH7lESPnU1HkjTqW+Y4UbwVABQ2Sg/rkQKDkDLjTx5ZF/DLYmf5juzi/8T5KXoF6pw5b7Hto8k/3CACuXGJ9UEap9Y+yGNMcwShrA42Es+mMkgLjrG6QIrLRdlNDwkjCdPZGhro447XeLlTB8sW/f21vXYHZ1GhYDZOjNenFs8SIFOSsdOTB+xTgpcww2IJkGfg3SqiKHik7hL8/FUDjBUP+8TGnd0N1jEz3KkVZc="

    - secure: "iFZSRORUbxziA5R1E3KMLGKp1/WwhnyzISS/C641N2wa8YyYQzWJHlzqb8R/Jv2rPrZxZ9XRAuLQqvwC2zDIeUQ2fiGisPe7567O9cTv13vwYsMU99btBNa3rsdmQDL2DeHeWVSpZmN3TNburg5dNL7s8no46V6BPV5dshZMAnCil2kjvbn1ZaJqEa5zxKW8lUpwPjso+sKSjT6O/n1pvcz4UvD5VeMeN1w+G8e7DbECNvhxpsVV6jrgSKA1taqHYCJ8UcebImY04AbsLOAKJv+ErjoXt0ad8K0HZb85mt2y+OkiwPYdA/AS1cbmWLXjsNyDmG2CYWU6tC+zugWmnmi+98Hk50Ip7FPM1LvCZr1+YkfOqrNheDfeRYPDS8ZhfEFsTnYC8/gCR49QZaeIs3vkmEpjikvIMgSvYkcU+uyLqUObv3943NHmniCcODOTGJHPc4eBfd3rf1FeEHOyA3MMC5CmUW952VqPCLN39FE8HoR0uLixJmTjjoHorzk6213FE7i4l4PjmIChfjYB5KuwPeHd3LPxwKm/ad/OsN7L6ajvSY/rg5+egi3LtRstwZHFey7mOwZvNPEQUmy/y3UEGLw+rH5BFjCjl0T532wWfdLZ3v3UITBmedrpNdr3YS2T1OJ98Rk7ogfHbSzLhIEDvvUtN7TY0SySTah0tMA="

    - secure: "JdSaIGjfUqwgEVhAeTmVOLWJMQ7Le1g5/4ix27t8ppN+0n4bnIn5E/cvmYCsw1b8WE5LigE+eFhlCzoBbY1fygh+dLloOfWYWtHhPHeo5SceFIdLNY6mvgoO/kaL6NeIldlGwBlAS0AU9QEXrX8DHQWxAXHmWEO72512RHziqX7Ovqf4+eUmwmQsSGgeDU9FUtQtQ7pAa/eW061AczQhfgXPSIb8Ljm5n3YBTTvYWrtgcLxQNlg/egD/e6rEDL2rJ94WjdVeFLWKOjziaNtm6ZYMoV8W3/H3ONMoU1lnn1pYiQs7lwNw1jyS6QT9Y0inxPINj1QLozJ0jpN/AZMo/Bi+NfVnWKxlbKtQvEalNEmZRcZwddVHqZerfqjcx1TO3hKEDgPv8/UxLat8MOg82sYZcpB1omuKc6h7yhrEHSAMR1RkQrnr7a+Kd2WsUL7lb0uz8J84JzTh9rWRgYaEVJyQW+W+2UXBiW/4kWzKhjN79rl7AJLJI0C59jWd6hs9DpkObgU5kU3pwf8e/tiC90pLujQUbOWXerm9EXpqp0ZzPY36Aj3o/FOD+ifOaQpUhZ9k/pJCqR32/jCSeWMxtfvI0AHUuwpX1+RB3pKAcPGDqz/F3/9JaGhJLbtu74naZK4S9AQy4jQfRMiOu+5p49934rgXuxYf7/JJrZNEVDk="